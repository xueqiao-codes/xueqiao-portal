<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>券商管理</title>
<link rel="stylesheet" href="${static_url}/css/bootstrap.min.css" />
<link rel="stylesheet" href="${static_url}/css/jquery-ui.min.css" />
<link rel="stylesheet" href="${static_url}/css/sled.custom.css" />

<script type="text/javascript" src="${static_url}/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="${static_url}/js/bootstrap.min.js"></script>
<script type="text/javascript" src="${static_url}/js/jquery-ui.min.js"></script>
</head>
<body>

	<!-- navigation bar -->
	<div class="navigation_bar">
		<div class="vertical_center">
			<span class="general_margin_left navigation_bar_font_default">当前位置:</span>
			<span class="navigation_bar_font_link"><a href="${base_url}/SledBrokerAdmin/show">券商管理</a></span>
			<span>></span>
			<span class="navigation_bar_font_default">${brokerCnName}&nbsp;${brokerAccessEntry.platform}接入详情</span>
		</div>
		<div class=" vertical_center">
			<div class="sled_align_rifht general_margin_right btn_edit_mode">
				<#if moduleEditable == 1>
					<a href="javascript:unlockModule();">退出编辑状态并同步</a>
				<#elseif moduleEditable == 2>
					<span>${lockModule!""}模块在编辑中</span>
				<#elseif moduleEditable == 3>
					<span>${lockUserName}在编辑${lockModule!""}模块</span>
				<#else>
					<a href="javascript:lockModule();">进入编辑状态</a>
				</#if>
			</div>
		</div>
	</div>

	<div class="col-md-12 general_margin_top">
	
		<!-- title bar -->
		<div class="sled_panel title_bar">
			<div class="vertical_center">
				<span class="general_margin_left title_font"><b>${brokerCnName}&nbsp;&nbsp;&nbsp;${brokerAccessEntry.platform}接入详情</b></span>
				<#if (platform!"") == "CTP">
					<span style="margin-left: 100px;">&nbsp;</span>
					<#if brokerAccessEntry.brokerAccessEntryList??>
						<#list brokerAccessEntry.brokerAccessEntryList as simpleBrokerAccessEntry>
							<a href="${base_url}/SledBrokerAccessAdmin/show?entryId=${simpleBrokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}"><span <#if (simpleBrokerAccessEntry.entryId == brokerAccessEntry.entryId)>class="tab_active"<#else>class="tab_inactive"</#if>><b><#if simpleBrokerAccessEntry.accessName?default("")?trim?length gt 1>${simpleBrokerAccessEntry.accessName}<#else>主席</#if></b></span></a>&nbsp;&nbsp;
						</#list>
					</#if>
				</#if>
			</div>
			<#if (platform!"") == "CTP">
				<div class=" vertical_center">
					<#if moduleEditable == 1>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_enable" id="btn-add-broker-access-entry">添加席</button></div>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_enable" id="btn-modify-broker-access-name">编辑当前席名称</button></div>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_enable" id="btn-remove-current-access-entry">删除当前席</button></div>
					<#else>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_disable" disabled="disabled" id="btn-add-broker-access-entry">添加席</button></div>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_disable" disabled="disabled" id="btn-modify-broker-access-name">编辑当前席名称</button></div>
						<div class="sled_align_rifht general_margin_right"><button class="sled_btn_disable" disabled="disabled" id="btn-remove-current-access-entry">删除当前席</button></div>
					</#if>
				</div>
			</#if>
		</div>
		
		<!-- status bar -->
		<div class="sled_panel status_bar">
			<div class="vertical_center">
			
				<span class="general_margin_left status_bar_font">接入状态：</span><span class="status_bar_font">${brokerAccessEntry.status}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<span class="status_bar_font">使用状态：</span><span class="status_bar_font">${brokerAccessEntry.workingStatus}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<#if moduleEditable == 1>
					<span class="status_bar_font">技术平台环境：</span><a href="javascript:showTechPlatformEnvDialog();"><span class="label label-info status_bar_font">${brokerAccessEntry.techPlatformEnv}</span></a>
				<#else>
					<span class="status_bar_font">技术平台环境：</span><span class="status_bar_font">${brokerAccessEntry.techPlatformEnv}</span>
				</#if>
			</div>
			<div class=" vertical_center">
				<div class="sled_align_rifht general_margin_right">
				
					<!-- <a href="javascript:validate();"><span class="badge">验证</span></a>
					<a href="javascript:sync();"><span class="badge">同步</span></a>
					<a href="javascript:recover();"><span class="badge">恢复到线上数据</span></a> -->
					<#if moduleEditable == 1>
						<button class="sled_btn_enable" id="btn-validate">验证</button>
						<button class="sled_btn_enable" id="btn-recover">恢复到线上数据</button>
					<#else>
						<button class="sled_btn_disable" disabled="disabled" id="btn-validate">验证</button>
						<button class="sled_btn_disable" disabled="disabled" id="btn-recover">恢复到线上数据</button>
					</#if>
				</div>
			</div>
		</div>
		
	</div>
		<!-- <div class="col-md-4 sled_panel general_margin_top"> -->
		<div class="col-md-4 general_margin_top">
			<div class="panel panel-default">
		
				<div class="general_bg_default">
				
					<!-- content title bar -->
					<div class="content_title_bar">
						<div class=" vertical_center">
							<span class="content_title_bar_font">交易地址</span>
							<div class="sled_align_rifht">
								<#if moduleEditable == 1>
									<button id="btn-add-trade-address" class="sled_btn_enable">添加</button>
								<#else>
									<button id="btn-add-trade-address" class="sled_btn_disable" disabled="disabled">添加</button>
								</#if>
							</div>
						</div>
					</div>
					
					<!-- table -->
					<table class="table table-bordered" style="border: 1px;">
						<tr bgColor=#F8FCFF>
							<th class="table_nav_key" width="200">地址</th>
							<th class="table_nav_key" width="50">删除</th>
						</tr>
						<#if brokerAccessEntry.tradeAddressList??>
							<#list brokerAccessEntry.tradeAddressList as tradeAddress>
								<tr>
									<td align="center">${tradeAddress.address}:${tradeAddress.port?c}</td>
									<#if moduleEditable == 1>
										<td align="center"><a href="javascript:showRemoveAccessAddressDialog('type_trade', '${tradeAddress.address}', '${tradeAddress.port?c}');"><img src="${static_url}/img/icon_delete.png"/></a></td>
									<#else>
										<td align="center"><img src="${static_url}/img/icon_delete_disabled.png"/></td>
									</#if>
									
								</tr>
							</#list>
						<#else>没有数据 </#if>
					</table>
				</div>
			</div>
		</div>
		
		<div class="col-md-4 general_margin_top">
			<div class="panel panel-default">
			
				<div class="general_bg_default">
					<!-- content title bar -->
					<div class="content_title_bar">
						<div class=" vertical_center">
							<span class="content_title_bar_font">行情地址</span>
							<div class="sled_align_rifht">
								<#if moduleEditable == 1>
									<button id="btn-add-quota-address" class="sled_btn_enable">添加</button>
								<#else>
									<button id="btn-add-quota-address" class="sled_btn_disable" disabled="disabled">添加</button>
								</#if>
							</div>
						</div>
					</div>
					
					<!-- table -->
					<table class="table table-bordered" style="border: 1px;">
						<tr bgColor=#F8FCFF>
							<th class="table_nav_key" width="200">地址</th>
							<th class="table_nav_key" width="50">删除</th>
						</tr>
						<#if brokerAccessEntry.quotaAddressList??>
							<#list brokerAccessEntry.quotaAddressList as quotaAddress>
								<tr>
									<td align="center">${quotaAddress.address}:${quotaAddress.port?c}</td>
									<#if moduleEditable == 1>
										<td align="center"><a href="javascript:showRemoveAccessAddressDialog('type_quota', '${quotaAddress.address}', '${quotaAddress.port?c}');"><img src="${static_url}/img/icon_delete.png"/></a></td>
									<#else>
										<td align="center"><img src="${static_url}/img/icon_delete_disabled.png"/></td>
									</#if>
									
								</tr>
							</#list>
						<#else>没有数据 </#if>
					</table>
				</div>
			</div>
		</div>
		
		<div class="col-md-4 general_margin_top">
			<div class="panel panel-default">
				<div class="general_bg_default">
					<!-- content title bar -->
					<div class="content_title_bar">
						<div class=" vertical_center">
							<span class="content_title_bar_font">附加信息</span>
							<div class="sled_align_rifht">
								<#if moduleEditable == 1>
									<button id="btn-add-custom-info" class="sled_btn_enable">添加</button>
								<#else>
									<button id="btn-add-custom-info" class="sled_btn_disable" disabled="disabled">添加</button>
								</#if>
							</div>
						</div>
					</div>
					
					<!-- table -->
					<table class="table table-bordered" style="border: 1px;">
						<tr bgColor=#F8FCFF>
							<th class="table_nav_key" width="100">Key</th>
							<th class="table_nav_key" width="100">Value</th>
							<th class="table_nav_key" width="50">编辑</th>
							<th class="table_nav_key" width="50">删除</th>
						</tr>
						<#if brokerAccessEntry.customInfoMap??>
							<#list brokerAccessEntry.customInfoMap?keys as key>
								<tr>
									<td align="center">${key}</td>
									<td align="center">${brokerAccessEntry.customInfoMap[key]}</td>
									<#if moduleEditable == 1>
										<td align="center"><a href="javascript:showModifyCustomInfoDialog('${key}', '${brokerAccessEntry.customInfoMap[key]}');"><img src="${static_url}/img/icon_edit.png"/></a></td>
										<td align="center"><a href="javascript:showRemoveCustomInfoDialog('${key}', '${brokerAccessEntry.customInfoMap[key]}');"><img src="${static_url}/img/icon_delete.png"/></a></td>
									<#else>
										<td align="center"><img src="${static_url}/img/icon_edit_disabled.png"/></td>
										<td align="center"><img src="${static_url}/img/icon_delete_disabled.png"/></td>
									</#if>
									
								</tr>
							</#list>
						<#else>没有数据 </#if>
					</table>
				</div>
			</div>
		</div>
		
	<!-- </div> -->


	<!-- <div class="col-md-12">
		<span>当前位置：</span>
		<a href="${base_url}/SledBrokerAdmin/show"><span>券商列表</span></a>
		<span>&nbsp;>&nbsp;${brokerCnName}&nbsp;${brokerAccessEntry.platform}接入详情</span>
		<div style="height: 20px;"></div>
	</div> -->
	
	<!-- <nav class="nav navbar-default" role="navigation">
		<div class="collapse navbar-collapse">
			<div class="nav navbar-nav" style="font-size: 25px;">${brokerCnName}&nbsp;&nbsp;&nbsp;${brokerAccessEntry.platform}接入详情</div>
		</div>
	</nav> -->
	
	<!-- <div style="height: 10px;"></div>
	
	<div class="col-md-12">
		<div class="panel panel-default"> -->
			<!-- <#if (platform!"") == "CTP">
			<div class="panel-heading">
				<#if brokerAccessEntry.brokerAccessEntryList??>
				<#list brokerAccessEntry.brokerAccessEntryList as simpleBrokerAccessEntry>
					<a href="${base_url}/SledBrokerAccessAdmin/show?entryId=${simpleBrokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}"><span <#if (simpleBrokerAccessEntry.entryId == brokerAccessEntry.entryId)>class="label label-default"</#if>><#if simpleBrokerAccessEntry.accessName?default("")?trim?length gt 1>${simpleBrokerAccessEntry.accessName}<#else>主席</#if></span></a>&nbsp;&nbsp;
				</#list>
				</#if>
				<div class="navbar-right">
					<a href="javascript:showAddBrokerAccessEntryDialog();"><span class="badge">添加席</span></a>
					<a href="javascript:showModifyAccessNameDialog();"><span class="badge">编辑当前席名称</span></a>
					<a href="javascript:removeCurrentAccessEntry();"><span class="badge">删除当前席</span></a>&nbsp;&nbsp;&nbsp;
				</div>
			</div>
			</#if> -->
			<!-- <div class="panel-body"> -->
			<!-- <div class="col-md-12">
				<div style="float:left;height:40px;vertical-align:middle;">
					<span>接入状态：</span><span>${brokerAccessEntry.status}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<span>使用状态：</span><span>${brokerAccessEntry.workingStatus}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<span>技术平台环境：</span><a href="javascript:showTechPlatformEnvDialog();"><span class="badge">${brokerAccessEntry.techPlatformEnv}</span></a>
				</div>
				<div style="float:right;height:40px;vertical-align:middle;">
					<a href="javascript:validate();"><span class="badge">验证</span></a>
					<a href="javascript:sync();"><span class="badge">同步</span></a>
					<a href="javascript:recover();"><span class="badge">恢复到线上数据</span></a>
				</div>
			</div> -->
			
			<!-- <div class="col-md-6"> -->
				<!-- <div class="panel panel-default">
					<div class="panel-heading">
						<span>交易地址</span>
						<div class="navbar-right">
							<a href="javascript:showAddAccessAddressDialog('type_trade');"><span class="badge">添加</span></a>&nbsp;&nbsp;&nbsp;
						</div>
					</div>
					<div class="list_container">
						<table class="table table-striped table-bordered" style="border: 1px;">
							<tr>
								<th class="table_nav_key" width="200">地址</th>
								<th class="table_nav_key" width="50">删除</th>
							</tr>
							<#if brokerAccessEntry.tradeAddressList??>
							<#list brokerAccessEntry.tradeAddressList as tradeAddress>
							<tr>
								<td align="center">${tradeAddress.address}:${tradeAddress.port?c}</td>
								<td align="center"><a href="javascript:showRemoveAccessAddressDialog('type_trade', '${tradeAddress.address}', '${tradeAddress.port?c}');"><span class="glyphicon glyphicon-remove"></span></a></td>
							</tr>
							</#list>
							</#if>
						</table>
					</div>
				</div> -->
				
				<!-- <div class="panel panel-default">
					<div class="panel-heading">
						<span>行情地址</span>
						<div class="navbar-right">
							<a href="javascript:showAddAccessAddressDialog('type_quota');"><span class="badge">添加</span></a>&nbsp;&nbsp;&nbsp;
						</div>
					</div>
					<div class="list_container">
						<table class="table table-striped table-bordered" style="border: 1px;">
							<tr>
								<th class="table_nav_key" width="200">地址</th>
								<th class="table_nav_key" width="50">删除</th>
							</tr>
							<#if brokerAccessEntry.quotaAddressList??>
							<#list brokerAccessEntry.quotaAddressList as quotaAddress>
							<tr>
								<td align="center">${quotaAddress.address}:${quotaAddress.port?c}</td>
								<td align="center"><a href="javascript:showRemoveAccessAddressDialog('type_quota', '${quotaAddress.address}', '${quotaAddress.port?c}');"><span class="glyphicon glyphicon-remove"></span></a></td>
							</tr>
							</#list>
							</#if>
						</table>
					</div>
				</div> -->
			<!-- </div> -->
	
			<!-- <div class="col-md-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						<span>附加信息</span>
						<div class="navbar-right">
							<a href="javascript:showAddCustomInfoDialog();"><span class="badge">添加</span></a>&nbsp;&nbsp;&nbsp;
						</div>
					</div>
					<div class="list_container">
						<table class="table table-striped table-bordered" style="border: 1px;">
							<tr>
								<th class="table_nav_key" width="100">Key</th>
								<th class="table_nav_key" width="100">Value</th>
								<th class="table_nav_key" width="50">编辑</th>
								<th class="table_nav_key" width="50">删除</th>
							</tr>
							<#if brokerAccessEntry.customInfoMap??>
							<#list brokerAccessEntry.customInfoMap?keys as key>
							<tr>
								<td align="center">${key}</td>
								<td align="center">${brokerAccessEntry.customInfoMap[key]}</td>
								<td align="center"><a href="javascript:showModifyCustomInfoDialog('${key}', '${brokerAccessEntry.customInfoMap[key]}');"><span class="glyphicon glyphicon-edit"></span></a></td>
								<td align="center"><a href="javascript:showRemoveCustomInfoDialog('${key}', '${brokerAccessEntry.customInfoMap[key]}');"><span class="glyphicon glyphicon-remove"></span></a></td>
							</tr>
							</#list>
							</#if>
						</table>
					</div>
				</div>
			</div> -->
			
			<#if (brokerAccessEntry.platform!"") == "ESUNNY_3">
				<div class="col-md-12">
					<div class="panel panel-default">
					
						<div class="general_bg_default">
							<!-- content title bar -->
							<div class="content_title_bar">
								<div class=" vertical_center">
									<span class="content_title_bar_font">易盛9.0-3.0映射文件</span>
								</div>
							</div>
							
							<table class="table table-bordered" style="border: 1px;">
								<tr bgColor=#F8FCFF>
									<th class="table_nav_key" width="150">最后导入时间</th>
									<th class="table_nav_key" width="150">版本号</th>
									<th class="table_nav_key" width="150">MD5</th>
									<th class="table_nav_key" width="50">导入</th>
									<th class="table_nav_key" width="50">下载</th>
									<th class="table_nav_key" width="50">历史</th>
									<th class="table_nav_key" width="50">详情</th>
								</tr>
								<#if mapFileInfo??>
									<tr>
										<td align="center">${mapFileInfo.lastModityTime!""}</td>
										<td align="center">${mapFileInfo.version!""}</td>
										<td align="center">${mapFileInfo.fileMD5!""}</td>
										<#if moduleEditable == 1>
											<td align="center"><a href="javascript:showUploadMappingFileDialog(${brokerAccessEntry.brokerId?c});"><span>导入</span></a></td>
										<#else>
											<td align="center"><span class="sled_link_disable">导入</span></td>
										</#if>
										
										<td align="center"><a href="${mapFileInfo.url!''}"><span>下载</span></a></td>
										<td align="center"><a href="${base_url}/SledCommodityMapHistory/show?brokerEntryId=${brokerAccessEntry.brokerId?c}&brokerCnName=${brokerCnName!''}&platform=${brokerAccessEntry.platform!''}"><span>查看</span></a></td>
										<td align="center"><a href="${base_url}/SledCommodityMapDetail/show?brokerEntryId=${brokerAccessEntry.brokerId?c}&brokerCnName=${brokerCnName!''}&platform=${brokerAccessEntry.platform!''}"><span>查看</span></a></td>
									</tr>
								</#if>
							</table>
						</div>
					
						<!-- <div class="panel-heading">
							<span>易盛9.0-3.0映射文件</span>
						</div> -->
						<!-- <div class="list_container">
							<table class="table table-striped table-bordered" style="border: 1px;">
								<tr>
									<th class="table_nav_key" width="150">最后导入时间</th>
									<th class="table_nav_key" width="150">版本号</th>
									<th class="table_nav_key" width="150">MD5</th>
									<th class="table_nav_key" width="50">导入</th>
									<th class="table_nav_key" width="50">下载</th>
									<th class="table_nav_key" width="50">历史</th>
									<th class="table_nav_key" width="50">详情</th>
								</tr>
								<#if mapFileInfo??>
									<tr>
										<td align="center">${mapFileInfo.lastModityTime!""}</td>
										<td align="center">${mapFileInfo.version!""}</td>
										<td align="center">${mapFileInfo.fileMD5!""}</td>
										<td align="center"><a href="javascript:showUploadMappingFileDialog(${brokerAccessEntry.brokerId?c});"><span class="badge">导入</span></a></td>
										<td align="center"><a href="${mapFileInfo.url!''}"><span class="badge">下载</span></a></td>
										<td align="center"><a href="${base_url}/SledCommodityMapHistory/show?brokerEntryId=${brokerAccessEntry.brokerId?c}&brokerCnName=${brokerCnName!''}&platform=${brokerAccessEntry.platform!''}"><span class="badge">查看</span></a></td>
										<td align="center"><a href="${base_url}/SledCommodityMapDetail/show?brokerEntryId=${brokerAccessEntry.brokerId?c}&brokerCnName=${brokerCnName!''}&platform=${brokerAccessEntry.platform!''}"><span class="badge">查看</span></a></td>
									</tr>
								</#if>
							</table>
						</div> -->
					</div>
				</div>
			</#if>
			
		<!-- </div>
	</div> -->
	
	
	<div id="access_address_dialog">
		<input type="hidden" name="dialog_type" id="dialog_type">
		<input type="hidden" name="entry_id" id="entry_id" value=${brokerAccessEntry.entryId?c}>
		<fieldset>
			<label class="dialog_input_key" for="field_file">IP：</label>
			<input class="dialog_input_value" type="text" name="access_address_ip" id="access_address_ip" >
		</fieldset>
		<fieldset>
			<label class="dialog_input_key" for="field_file">端口：</label>
			<input class="dialog_input_value" type="text" name="access_address_port" id="access_address_port" 
			onKeyUp="this.value=this.value.replace(/\D/g,'');">
		</fieldset>
	</div>
	
	<div id="custom_info_map_dialog">
		<fieldset>
			<label class="dialog_input_key" for="field_file">Key：</label>
			<select id="custom_info_key" name="custom_info_key" class="dialog_input_value">
				<#if (platform!"") == "CTP">
				<option value="BROKER_ID_INFO">BROKER_ID_INFO</option>
				<option value="STS_APPID">STS_APPID</option>
				<option value="STS_AUTHCODE">STS_AUTHCODE</option>
				<option value="STS_ENABLED_MODE">STS_ENABLED_MODE</option>
				</#if>
			</select>
		</fieldset>
		<fieldset>
			<label class="dialog_input_key" for="field_file">Value：</label>
			<input class="dialog_input_value" type="text" name="custom_info_value" id="custom_info_value" >
		</fieldset>
	</div>
	
	<div id="modify_custom_info_map_dialog">
		<fieldset>
			<label class="dialog_input_key" for="field_file">Key：</label>
			<input class="dialog_input_value_readonly" type="text" name="modify_custom_info_key" id="modify_custom_info_key" readonly="true">
		</fieldset>
		<fieldset>
			<label class="dialog_input_key" for="field_file">Value：</label>
			<input class="dialog_input_value" type="text" name="modify_custom_info_value" id="modify_custom_info_value" >
		</fieldset>
	</div>
	
	<div id="tech_platform_env_dialog">
		<fieldset>
			<label class="dialog_input_key" for="field_file">Key：</label>
			<select id="tech_platform_env" name="tech_platform_env" class="dialog_input_value">
				<option value="NONE">NONE</option>
				<option value="REAL">REAL</option>
				<option value="SIM">SIM</option>
			</select>
		</fieldset>
	</div>
	
	<div id="modify_access_name_dialog">
		<input type="hidden" name="access_name_type" id="access_name_type">
		<fieldset>
			<label class="dialog_input_key" for="field_file">当前席名称：</label>
			<input class="dialog_input_value" type="text" name="access_name" id="access_name" >
		</fieldset>
	</div>
	
	<div id="upload_mapping_file_dialog">
		<form id="uploadFileForm" enctype="multipart/form-data" >
			<input type="hidden" name="broker_entry_id" id="broker_entry_id">
			<fieldset>
				<label style="width: 80px" for="mapping_file_version_code">版本号:</label> 
				<input class="dialog_input_value" type="text" name="mapping_file_version_code" id="mapping_file_version_code">
			</fieldset>
			<fieldset>
				<label style="width: 80px" for="mapping_file_md5_code">MD5:</label> 
				<input class="dialog_input_value" type="text" name="mapping_file_md5_code" id="mapping_file_md5_code">
			</fieldset>
			<fieldset style="position: relative;display: inline-block">
				<!-- <label style="width: 120px;text-align: right" for="field_file">文件:</label> -->
				<input style="width: 270px" type="file" name="file" id="field_file">
			</fieldset>
			<div id="upload_tips_text" style="display:none">正在上传...</div>
		</form>
	</div>
	
	<script>
	
	$("#btn-add-broker-access-entry").click(function( event ) {
		showAddBrokerAccessEntryDialog();
	});
	
	$("#btn-modify-broker-access-name").click(function( event ) {
		showModifyAccessNameDialog();
	});
	
	$("#btn-remove-current-access-entry").click(function( event ) {
		removeCurrentAccessEntry();
	});
	
	$("#btn-validate").click(function( event ) {
		validate();
	});
	
	$("#btn-recover").click(function( event ) {
		recover();
	});
	
	$("#btn-add-trade-address").click(function( event ) {
		showAddAccessAddressDialog('type_trade');
	});
	
	$("#btn-add-quota-address").click(function( event ) {
		showAddAccessAddressDialog('type_quota');
	});
	
	$("#btn-add-custom-info").click(function( event ) {
		showAddCustomInfoDialog();
	});
	
	
	$("#tech_platform_env_dialog").dialog({
		autoOpen : false,
		height : 200,
		width : 450,
		modal : true,
		buttons : {
			"确定" : function() {
				updateTechPlatformEnv();
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	$("#modify_access_name_dialog").dialog({
		autoOpen : false,
		height : 200,
		width : 450,
		modal : true,
		buttons : {
			"确定" : function() {
				
				var access_name_type = $("#access_name_type").val();
				var access_name = $("#access_name").val();
				
				if (access_name == null || access_name == undefined || access_name == '') {
					alert("请输入当前席名称");
					return;
				}
				
				if (access_name_type == "add_broker_access") {
					addBrokerAccessEntry(access_name);
				} else {
					updateAccessName();
				}
				
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	$("#access_address_dialog").dialog({
		autoOpen : false,
		height : 200,
		width : 450,
		modal : true,
		buttons : {
			"确定" : function() {
				
				var access_address_ip = $("#access_address_ip").val();
				var access_address_port = $("#access_address_port").val();
				
				if (access_address_ip == null || access_address_ip == undefined || access_address_ip == '') {
					alert('请输入IP');
					return;
				}
				if (access_address_port == null || access_address_port == undefined || access_address_port == '') {
					alert('请输入端口');
					return;
				}
				
				addAccessAddress();
				
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	$("#custom_info_map_dialog").dialog({
		autoOpen : false,
		height : 200,
		width : 450,
		modal : true,
		buttons : {
			"确定" : function() {
				
				var custom_info_key = $("#custom_info_key").val();
				var custom_info_value = $("#custom_info_value").val();
				
				if (custom_info_key == null || custom_info_key == undefined || custom_info_key == '') {
					alert(${platform} + "不支持附加信息");
					return;
				}
				if (custom_info_value == null || custom_info_value == undefined || custom_info_value == '') {
					alert('请输入值');
					return;
				}
				
				addCustomInfo();
				
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	$("#modify_custom_info_map_dialog").dialog({
		autoOpen : false,
		height : 200,
		width : 450,
		modal : true,
		buttons : {
			"确定" : function() {
				
				var custom_info_key = $("#modify_custom_info_key").val();
				var custom_info_value = $("#modify_custom_info_value").val();
				
				if (custom_info_key == null || custom_info_key == undefined || custom_info_key == '') {
					alert(${platform} + "不支持附加信息");
					return;
				}
				if (custom_info_value == null || custom_info_value == undefined || custom_info_value == '') {
					alert('请输入值');
					return;
				}
				
				modifyCustomInfo();
				
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	$("#upload_mapping_file_dialog").dialog({
		autoOpen : false,
		height : 300,
		width : 500,
		modal : true,
		buttons : {
			"上传" : function() {
				doUploadMappingFile();
				$(this).dialog("close");
			},
			"取消" : function() {
				$(this).dialog("close");
			}
		}
	});
	
	function removeCurrentAccessEntry() {
		if (confirm("确认删除${brokerAccessEntry.accessName}？")) {
			$.ajax({
				type : "POST",
				dataType : "json",
				url : "${base_url}/SledBrokerAccessAdmin/removeAccessEntry",
				data : {
					entryId : ${brokerAccessEntry.entryId?c},
				},
				timeout : 3000,
				async : false,
				error : function(request, textStatus, errorThrown) {
					if (request.status >= 500) {
						alert('服务器繁忙，请重试');
					} else if (request.status != 0) {
						alert('连接服务器失败, 请检查网络');
					}
				},
				success : function(result) {
					if (result.errorCode == 0) {
						alert("删除成功");
						window.location.href='${base_url}/SledBrokerAccessAdmin/show?brokerId=${brokerAccessEntry.brokerId?c}&platform=${brokerAccessEntry.platform}&brokerCnName=${brokerCnName}';
					} else {
						alert(result.errorMsg);
					}
				},
				complete : function(data) {
				}
			});
		}
	}
	
	function validate() {
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/validate",
			data : {
				entryId : ${brokerAccessEntry.entryId?c},
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("验证完成");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorCode + ":" + result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function sync() {
		if (confirm("同步后将启用，是否同步和启用？")) {
			$.ajax({
				type : "POST",
				dataType : "json",
				url : "${base_url}/SledBrokerAccessAdmin/sync",
				data : {
					entryId : ${brokerAccessEntry.entryId?c},
				},
				timeout : 3000,
				async : false,
				error : function(request, textStatus, errorThrown) {
					if (request.status >= 500) {
						alert('服务器繁忙，请重试');
					} else if (request.status != 0) {
						alert('连接服务器失败, 请检查网络');
					}
				},
				success : function(result) {
					if (result.errorCode == 0) {
						alert("同步成功");
					} else {
						alert(result.errorCode + ":" + result.errorMsg);
					}
				},
				complete : function(data) {
				}
			});
		}
	}
	
	function recover() {
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/recover",
			data : {
				entryId : ${brokerAccessEntry.entryId?c},
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("恢复成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorCode + ":" + result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function updateTechPlatformEnv() {
		var tech_platform_env = $("#tech_platform_env").val();
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/updateTechPlatformEnv",
			data : {
				entryId : ${brokerAccessEntry.entryId?c},
				techPlatformEnv : tech_platform_env,
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("修改成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function showTechPlatformEnvDialog() {
		
		$("#tech_platform_env").val('${brokerAccessEntry.techPlatformEnv}');
		
		$("#tech_platform_env_dialog").dialog("option", "title", "修改技术平台环境");
		$("#tech_platform_env_dialog").dialog("open");
	}
	
	function showAddBrokerAccessEntryDialog() {
		$("#access_name").val("");
		$("#access_name_type").val("add_broker_access");
		
		$("#modify_access_name_dialog").dialog("option", "title", "输入席名称");
		$("#modify_access_name_dialog").dialog("open");
	}
	
	function showModifyAccessNameDialog() {
		$("#access_name").val('${brokerAccessEntry.accessName}');
		$("#access_name_type").val("modify_access_name");
		
		$("#modify_access_name_dialog").dialog("option", "title", "编辑当前席名称");
		$("#modify_access_name_dialog").dialog("open");
	}
	
	function showAddAccessAddressDialog(type) {
		$("#dialog_type").val(type);
		if (type == "type_trade") {
			$("#access_address_dialog").dialog("option", "title", "添加交易地址");
		} else if (type == "type_quota"){
			$("#access_address_dialog").dialog("option", "title", "添加行情地址");
		}
		$("#access_address_dialog").dialog("open");
	}
	
	function showAddCustomInfoDialog() {
		$("#custom_info_key").val("");
		$("#custom_info_value").val("");
		
		$("#custom_info_map_dialog").dialog("option", "title", "添加附加信息");
		$("#custom_info_map_dialog").dialog("open");
	}
	
	function showModifyCustomInfoDialog(CustomInfoKey, CustomInfoValue) {
		$("#modify_custom_info_key").val(CustomInfoKey);
		$("#modify_custom_info_value").val(CustomInfoValue);
		
		$("#modify_custom_info_map_dialog").dialog("option", "title", "修改附加信息");
		$("#modify_custom_info_map_dialog").dialog("open");
	}
	
	function showUploadMappingFileDialog(brokerId) {
		$("#broker_entry_id").val(brokerId);
		$("#field_file").val(null);
		document.getElementById("upload_tips_text").innerHTML="";
		$("#upload_mapping_file_dialog").dialog("option", "title", "导入映射文件");
		$("#upload_mapping_file_dialog").dialog("open");
	}
	
	function showRemoveAccessAddressDialog(type, accessAddressIp, accessAddressPort) {
		
		if (confirm("确认删除？")) {
			$.ajax({
				type : "POST",
				dataType : "json",
				url : "${base_url}/SledBrokerAccessAdmin/removeAccessAddress",
				data : {
					entryId : ${brokerAccessEntry.entryId?c},
					addressType : type,
					accessAddressIp : accessAddressIp,
					accessAddressPort : accessAddressPort,
				},
				timeout : 3000,
				async : false,
				error : function(request, textStatus, errorThrown) {
					if (request.status >= 500) {
						alert('服务器繁忙，请重试');
					} else if (request.status != 0) {
						alert('连接服务器失败, 请检查网络');
					}
				},
				success : function(result) {
					if (result.errorCode == 0) {
						alert("删除成功");
						window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
					} else {
						alert(result.errorMsg);
					}
				},
				complete : function(data) {
				}
			});
		}
	}
	
	function showRemoveCustomInfoDialog(customInfoKey, customInfoValue) {
		if (confirm("确认删除？")) {
			$.ajax({
				type : "POST",
				dataType : "json",
				url : "${base_url}/SledBrokerAccessAdmin/removeCustomInfo",
				data : {
					entryId : ${brokerAccessEntry.entryId?c},
					customInfoKey : customInfoKey,
					customInfoValue : customInfoValue,
				},
				timeout : 3000,
				async : false,
				error : function(request, textStatus, errorThrown) {
					if (request.status >= 500) {
						alert('服务器繁忙，请重试');
					} else if (request.status != 0) {
						alert('连接服务器失败, 请检查网络');
					}
				},
				success : function(result) {
					if (result.errorCode == 0) {
						alert("删除成功");
						window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
					} else {
						alert(result.errorMsg);
					}
				},
				complete : function(data) {
				}
			});
		}
	}
	
	function updateAccessName() {
		
		var access_name = $("#access_name").val();
		
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/updateAccessName",
			data : {
				entryId : ${brokerAccessEntry.entryId?c},
				accessName : access_name,
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("修改成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function addBrokerAccessEntry(access_name) {
		if (confirm("确认添加？")) {
			
			var platform = "${brokerAccessEntry.platform}";
			
			$.ajax({
				type : "POST",
				dataType : "json",
				url : "${base_url}/SledBrokerAccessAdmin/addBrokerAccessEntry",
				data : {
					brokerId : ${brokerAccessEntry.brokerId?c},
					platform : platform,
					accessName : access_name,
				},
				timeout : 3000,
				async : false,
				error : function(request, textStatus, errorThrown) {
					if (request.status >= 500) {
						alert('服务器繁忙，请重试');
					} else if (request.status != 0) {
						alert('连接服务器失败, 请检查网络');
					}
				},
				success : function(result) {
					if (result.errorCode == 0) {
						alert("添加成功");
						window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
					} else {
						alert(result.errorMsg);
					}
				},
				complete : function(data) {
				}
			});
		}
	}
	
	function addAccessAddress() {
		var entryId = $("#entry_id").val();
		var type = $("#dialog_type").val();
		var access_address_ip = $("#access_address_ip").val();
		var access_address_port = $("#access_address_port").val();
		
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/addAccessAddress",
			data : {
				entryId : entryId,
				addressType : type,
				accessAddressIp : access_address_ip,
				accessAddressPort : access_address_port,
			},
			timeout : 60000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(data) {
				if (data.errorCode == 0) {
					alert("操作成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(data.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function addCustomInfo() {
		var entryId = ${brokerAccessEntry.entryId?c};
		var custom_info_key = $("#custom_info_key").val();
		var custom_info_value = $("#custom_info_value").val();
		
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/addCustomInfo",
			data : {
				entryId : entryId,
				customInfoKey : custom_info_key,
				customInfoValue : custom_info_value,
			},
			timeout : 60000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(data) {
				if (data.errorCode == 0) {
					alert("操作成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(data.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function modifyCustomInfo() {
		var entryId = ${brokerAccessEntry.entryId?c};
		var custom_info_key = $("#modify_custom_info_key").val();
		var custom_info_value = $("#modify_custom_info_value").val();
		
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/addCustomInfo",
			data : {
				entryId : entryId,
				customInfoKey : custom_info_key,
				customInfoValue : custom_info_value,
			},
			timeout : 60000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(data) {
				if (data.errorCode == 0) {
					alert("操作成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(data.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	function doUploadMappingFile() {
		var formData = new FormData(document.getElementById("uploadFileForm"));
		document.getElementById("upload_tips_text").innerHTML="正在上传...";
		$('#upload_tips_text').show();
		$.ajax({
			url: '${static_url}/UploadCommodityMappingFile',  //server script to process data
			type: 'POST',
			data: formData,
			timeout : 6000000,
			//Options to tell JQuery not to process data or worry about content-type
			cache: false,
			processData: false,  //Add this
			contentType: false, //Add this
			success: function(result) {
				if (result.errorCode == 0) {
					alert("上传成功");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorMsg);
				}
			},
			error : function(request, textStatus, errorThrow) {
				if (request.status >= 500) {
					alert("服务器繁忙，请重试");
				} else {
					alert("连接服务器失败，请检查网络");
				}
				//window.location.href='${base_url}/SledCommodityMapAdmin/show';
			},
			complete : function(data) {
				$('#upload_tips_text').hidden();
			}	
		});
	}
	
	function unlockModule() {
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/unlockModuleBroker",
			data : {
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("退出编辑状态");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}

	function lockModule() {
		$.ajax({
			type : "POST",
			dataType : "json",
			url : "${base_url}/SledBrokerAccessAdmin/lockModuleBroker",
			data : {
			},
			timeout : 3000,
			async : false,
			error : function(request, textStatus, errorThrown) {
				if (request.status >= 500) {
					alert('服务器繁忙，请重试');
				} else if (request.status != 0) {
					alert('连接服务器失败, 请检查网络');
				}
			},
			success : function(result) {
				if (result.errorCode == 0) {
					alert("进入编辑状态");
					window.location.href='${base_url}/SledBrokerAccessAdmin/show?entryId=${brokerAccessEntry.entryId?c}&brokerCnName=${brokerCnName}';
				} else {
					alert(result.errorMsg);
				}
			},
			complete : function(data) {
			}
		});
	}
	
	</script>

</body>
</html>